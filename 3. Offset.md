# Оффсет
В Apache Kafka, оффсеты - это позиции в очереди сообщений, которые определяют, на каком сообщении в теме (topic) нужно начать чтение.  
Обычно оффсеты автоматически управляются группой потребителей (consumer group) в Kafka.

### Основные понятия 
**Messages Behind/Lag (Отставание сообщений):**
Это метрика, которая показывает сколько сообщений от текущей позиции потребителя (текущий оффсет) до последнего доступного сообщения в разделе (end offset). Отставание сообщений (messages behind) указывает на то, насколько потребитель отстает от конца раздела. Это полезная метрика для мониторинга производительности и скорости обработки данных.

**Current Offset (Текущий оффсет):**
Это позиция потребителя в теме (разделе). Это означает номер последнего сообщения, которое было успешно прочитано потребителем. Как только потребитель прочитывает сообщение, его оффсет увеличивается. Это дает потребителю информацию о текущей позиции в потоке данных.

**End Offset (Конечный оффсет):**
Это позиция последнего доступного сообщения в теме (разделе). End offset представляет собой номер последнего сообщения в разделе. Это важная метрика, потому что она указывает на общее количество сообщений в разделе.

**Offset commit(Фиксация смещения):**
Позволяет группе потребителей периодически фиксировать свое текущее смещение в постоянное хранилище, такое как Apache Zookeeper или встроенное хранилище смещений Kafka.
Это гарантирует, что группа потребителей сможет возобновить работу с последнего зафиксированного смещения в случае сбоя или перебалансировки. 

### Управление оффсетам

**Посмотреть оффсеты всех топиков**
```bash
kafka-consumer-groups --bootstrap-server kafka.dev.big-company.com:9092 --describe --group group.dev
```
Выводит оффсеты и лаги группы group.dev по всем топикам. Каждая партиция отдельно.

**Сброс оффсетов**
```bash
kafka-consumer-groups --bootstrap-server kafka.dev.big-company.com:9092 --reset-offsets --to-offset 340000 --group group.dev --topic actions --execute
```
Выставляет оффсет топика ```actions``` на указанное значение, если это возможно. Консьюмеры должны быть **ВЫКЛЮЧЕНЫ** в момент исполнения команды.
```bash
kafka-consumer-groups --bootstrap-server kafka.dev.big-company.com:9092 --reset-offsets --to-latest --group group.dev — topic actions --execute
```
Выставляет оффсет топика ```actions``` на самое раннее возможное значение. Консьюмеры должны быть **ВЫКЛЮЧЕНЫ**.

Для предыдущих двух команд можно указать --all-topics вместо названия топика.
